# Eureka

## 核心架构

### Eureka Server（服务注册中心）

#### 服务注册（Register）

当有新的服务启动后进行调用来实现服务注册，活着心跳检测到服务状态异常时，变更对应服务的状态。

服务注册就是发送一个POST请求带上当前实例信息到类ApplicationResource的addInstance方法进行服务注册。

#### 服务续约（Renew）

服务续约由服务提供者定期调用，类似于心跳，用来告知注册中心Eureka Server自己的状态，避免被Eureka Server认为服务失效将其剔除下线。

服务续约就是发送一个PUT请求带上当前实例信息到类InstanceResource的renewLease方法进行服务续约操作。

#### 服务下线（Cancel）

当服务提供者停止服务时，会发送请求告知注册中心Eureka Server进行服务剔除下线操作，防止服务消费者从注册中心调用到不存在的服务。

服务下线就是发送一个DELETE请求带上当前实例信息到类InstanceResource的cacleLease方法进行服务剔除下线操作。

#### 服务剔除（Eviction）

服务剔除是注册中心在启动时就启动一个守护线程evictionTimer来定期（默认60秒）执行检测服务的，判断标准是超过一定时间没有进行Renew的服务，默认失效时间是90秒，也就是说一个已注册的服务在90秒内没有向注册中心进行服务续约，就会被注册中心剔除下线。

### Service Provider（服务提供者）

#### 服务注册（Register）

一个服务要对外提供服务，首先要在注册中心进行服务相关信息注册。注册中心不需要把自己注册到注册中心去。

#### 服务续约（Renew）

服务提供者定期发起心跳，主要是用来告知注册中心自己状态正常。

#### 服务下线（Cancel）

当服务提供者的服务停止时，要发送DELETE请求告知注册中心已经下线，让注册中心将自己剔除下线，防止服务消费者从注册中心获取到不可用的服务。

### Service Consumer（服务消费者）

#### 获取服务列表（Fetch）

服务消费者启动之后首先要从注册中心获取到可用的服务列表，同时本地会缓存一份。

#### 更新服务列表（Update）

需要定期从注册中心获取服务的最新配置，然后比较更新本地缓存。

# YOLO模型（You only look once）

## 基本特点

1. 速度快：是一种端到端的算法，可以在一次前向传递中同时检测多个对象，因此速度非常快，适用于实时应用。
2. 准确率高：使用整个图像进行检测，可以捕获全局的上下文信息，从而提高检测准确率。
3. 可解释性强：使用单个神经网络进行检测，可以直接输出边界框的坐标和类别概率，易于理解和解释。
4. 适用性广：可以应用于不同的目标检测任务。

## 核心原理

YOLO将图像分割成SxS的网格。如果一个目标的中心落入一个网格单元，该网格单元负责检测该目标。每个网格单元预测这些盒子的边界框和置信度分数。置信度分数反应了该模型对盒子是否包含目标的置信度，以及它预测盒子的准确度。

## 模型输出

1. 边界框（Bounding Boxes）参数：每个边界框包含5个预测：x、y、w、h和confidence。（x，y）坐标表示边界框相对于网格单元边界框的中心。宽w和高h是整张图像相对长度预测。还有一个置信度，计算公式：

$$confidence=Pr(object)* IOU^{truth}_pred$$
$Pr(object)$ 表示该边界框包含对象的概率，$IOU^{truth}_pred$ 是预测边界框和真实边界框的交并比。
2. 类别概率参数：每个网格单元还预测C个条件类别概率 $Pr(object)$。这些概率是在网格单元上包含物体置信度的概率。

## 模型融合

通常会对卷积层和批归一化层（Batch Normalization，BN）进行融合优化，这个过程被称为层融合（Layer Fusion）。主要目的是提升推理速度，同时减少运行时的计算开销。

### 层融合的操作

在推理阶段，卷积层和批归一化层可以被数学上等效地合并为一个卷积层。减少了模型在推理时的计算图复杂性，提高了执行效率。

### forward_fuse

- 普通前向传播（forward）：适用于训练阶段或未经过层融合的模型，计算需要独立执行卷积和批归一化。
- 融合前向传播（forward_fuse）：用于推理阶段，假设模型中的卷积层和批归一化层已经融合，不需要再分别执行这两部分操作。

### 使用场景

1. 融合模型

    ```python
    model = YOLO("yolov8n.pt") # 加载模型
    model.fuse() # 对卷积和批归一化层进行融合
    ```

2. 推理使用forward_fuse

    ```python
    results = model.forward_fuse(image) # 用于推理阶段
    ```

# 问题排查

## Java程序CPU飙高问题排查

```shell
top // 查看进程CPU情况，找到CPU占用高的进程ID
ps H -eo pid,tid,%cpu | grep 进程ID // 查看线程CPU情况
jstack 进程ID // 查看线程堆栈信息
printf "%x\n" 线程ID // 查看线程ID的16进制表示
```

## Java内存泄露问题排查

1. 通过jmap指定打印内存快照dump，如果程序退出无法使用该方法

    ```shell
    jmap -dump:format=b,file=heap.hprof 进程ID
    ```

2. 使用jvm参数获取dump文件

    ```shell
    -XX:HeapDumpOnOutOfMemoryError
    -XX:HeapDumpPath=/home/app/dumps.hprof
    ```

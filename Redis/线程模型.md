# Redis线程模型

Redis基于Reactor模式设计开发了一套高效的事件处理模型，这套事件处理模型对应的是Redis中的文件事件处理器（file event handler）。由于文件事件处理器（file event handler）是单线程方式运行的，所以一般说Redis是单线程模型。

Redis通过IO多路复用程序来监听来自客户端的大量连接（或者说是监听多个socket），会将感兴趣的事件以及类型（读、写）注册到内核中并监听每个事件是否发生。I/O多路复用技术的使用让Redis不需要额外创建多余线程来监听客户端的大量连接，降低了资源的消耗。

## 文件事件处理器

文件事件处理器主要包含四个部分：

- 多个socket（客户端连接）
- IO多路复用程序（支持多个客户端连接的关键）
- 文件事件分派器（将socket关联到相应的事件处理器）
- 事件处理器（连接应答处理器、命令请求处理器、命令回复处理器）

![文件事件处理器](images/文件事件处理器.png)

## Redis6.0 之前为什么不使用多线程

Redis4.0之后的版本就加入了对多线程的支持。增加的多线程主要是针对一些大键值对的删除操作的命令，使用这些命令会使用主线程之外的其他线程来异步处理，减少对主线程的影响。

## 为什么引入多线程

Redis引入多线程主要是为了提高网络IO读写性能，因为这个算是Redis的一个性能瓶颈（Redis的瓶颈主要受限于内存和网络）。

Redis的多线程只是在网络数据的读写这类耗时操作上，执行命令仍然是单线程顺序执行，因此不需担心线程安全问题。Redis的多线程默认是禁用的，只使用主线程。如果需要开启设置IO线程数>1，需要修改redis配置文件redis.conf。

(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["apps"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},3685:function(e,t,a){},"3a4b":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"apps-page"},[a("h1",{staticClass:"main-title"},[e._v("APP管理 "),a("div",{staticClass:"right"},[e.$HAS_PERMISSION("mango:app:w")?a("el-button",{attrs:{size:"medium",icon:"el-icon-plus",type:"success",plain:""},on:{click:e.handleAdd}},[e._v("添加应用")]):e._e()],1)]),a("div",{staticClass:"search-wrap do-card"},[a("div",{staticClass:"bd"},[a("el-form",{attrs:{inline:"","label-width":"100px"}},[a("el-form-item",{attrs:{label:"包名"}},[a("el-input",{nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(!0)}},model:{value:e.query.pkg,callback:function(t){e.$set(e.query,"pkg",t)},expression:"query.pkg"}})],1)],1),a("div",{staticClass:"ctrl tr"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.search(!0)}}},[e._v("搜索")])],1)],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"table-wrap do-card"},[a("div",{staticClass:"bd"},[a("el-table",{staticClass:"hide-border",attrs:{data:e.tableData,border:"","default-sort":{prop:e.defaultSort.prop,order:e.defaultSort.order}},on:{"sort-change":e.handleSortChange}},[a("el-table-column",{attrs:{label:"ID",width:"180","show-overflow-tooltip":!0,sortable:"custom","sort-orders":e.defaultSortOrders,prop:"id"}}),a("el-table-column",{attrs:{label:"应用名","min-width":"120",prop:"name"}}),a("el-table-column",{attrs:{label:"包名","min-width":"100","show-overflow-tooltip":!0,sortable:"custom","sort-orders":e.defaultSortOrders,prop:"pkg"}}),a("el-table-column",{attrs:{label:"提现开关",width:"80",align:"center",prop:"hasWechatWithdrawal"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("tfSwitch")(a.hasWechatWithdrawal))+" ")]}}])}),a("el-table-column",{attrs:{label:"Debug 开关",width:"100",align:"center",prop:"isDebugModel"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("tfSwitch")(a.isDebugModel))+" ")]}}])}),a("el-table-column",{attrs:{label:"创建时间","min-width":"120","show-overflow-tooltip":!0,sortable:"custom","sort-orders":e.defaultSortOrders,prop:"createTime"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("date")(a.createTime,"dateTime"))+" ")]}}])}),a("el-table-column",{attrs:{label:"最近修改时间","min-width":"120","show-overflow-tooltip":!0,sortable:"custom","sort-orders":e.defaultSortOrders,prop:"lastModifyTime"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v(" "+e._s(e._f("date")(a.lastModifyTime,"dateTime"))+" ")]}}])}),a("el-table-column",{attrs:{label:"修改人",width:"",align:"center",sortable:"custom","sort-orders":e.defaultSortOrders,prop:"lastModifyBy"}}),e.$HAS_PERMISSION("mango:app:w")?a("el-table-column",{attrs:{"class-name":"ctrl-td",width:"165px",align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[a("el-button",{attrs:{type:"primary",plain:"",size:"mini",icon:"el-icon-edit"},on:{click:function(t){return e.handleEdit(o)}}}),a("el-popconfirm",{attrs:{title:"确定删除吗？"},on:{onConfirm:function(t){return e.handleDel(o)}}},[a("el-button",{attrs:{slot:"reference",type:"danger",plain:"",size:"mini",icon:"el-icon-delete",loading:o._deleting},slot:"reference"})],1)]}}],null,!1,2143960252)}):e._e()],1)],1)]),a("base-pagination",{attrs:{"current-page":e.query.pageNum,"page-size":e.query.pageSize,total:e.total},on:{"current-change":e.handlePnChange,"size-change":e.handleSizeChange}}),a("edit-popup",{ref:"editPopup",attrs:{visible:e.showPopup},on:{ok:e.search,"update:visible":function(t){e.showPopup=t}}})],1)},i=[],r=(a("d3b7"),a("ac1f"),a("841c"),a("619b")),l=a("1a91"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:("create"===e.mode?"添加":"修改")+"应用",visible:e.dialogVisible,width:"550px"},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.resetPanel}},[a("el-form",{ref:"form",attrs:{"label-width":"160px",size:"small",model:e.form,rules:e.formRules}},[a("el-form-item",{attrs:{prop:"name",label:"应用名"}},[a("el-input",{attrs:{placeholder:"请输入应用名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{prop:"pkg",label:"包名"}},[a("el-input",{attrs:{placeholder:"请输入包名"},model:{value:e.form.pkg,callback:function(t){e.$set(e.form,"pkg",t)},expression:"form.pkg"}})],1),a("el-form-item",{attrs:{prop:"weChatAppId",label:"微信AppId"}},[a("el-input",{attrs:{placeholder:"微信登录用AppId"},model:{value:e.form.weChatAppId,callback:function(t){e.$set(e.form,"weChatAppId",t)},expression:"form.weChatAppId"}})],1),a("el-form-item",{attrs:{prop:"weChatAppSecret",label:"开发平台APP Secret"}},[a("el-input",{attrs:{placeholder:"开发平台APP Secret"},model:{value:e.form.weChatAppSecret,callback:function(t){e.$set(e.form,"weChatAppSecret",t)},expression:"form.weChatAppSecret"}})],1),a("el-form-item",{attrs:{prop:"hasWechatWithdrawal",label:"微信提现开关"}},[a("el-switch",{model:{value:e.form.hasWechatWithdrawal,callback:function(t){e.$set(e.form,"hasWechatWithdrawal",t)},expression:"form.hasWechatWithdrawal"}})],1),a("el-form-item",{attrs:{prop:"isDebugModel",label:"Debug模式开关"}},[a("el-switch",{model:{value:e.form.isDebugModel,callback:function(t){e.$set(e.form,"isDebugModel",t)},expression:"form.isDebugModel"}})],1),a("el-form-item",{attrs:{prop:"appVns",label:"版本号"}},[a("el-input",{staticClass:"version-input",attrs:{disabled:!e.versionEditable,placeholder:"如：101,102"},model:{value:e.form.appVns,callback:function(t){e.$set(e.form,"appVns",t)},expression:"form.appVns"}}),a("el-button",{staticClass:"ml-gap-s",attrs:{icon:"el-icon-edit",type:e.versionEditable?"success":""},on:{click:function(t){e.versionEditable=!e.versionEditable}}})],1),a("el-form-item",{attrs:{prop:"sids",label:"广告位"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.form.sids,callback:function(t){e.$set(e.form,"sids",t)},expression:"form.sids"}})],1),a("el-divider",{staticClass:"mb-gap",attrs:{"content-position":"left"}},[a("span",{staticClass:"color-gray"},[e._v("若产品要接入任务系统，则以下选项必填！")])]),a("el-form-item",{attrs:{prop:"weChatMchid",label:"微信商户号"}},[a("el-input",{attrs:{placeholder:"微信商户号"},model:{value:e.form.weChatMchid,callback:function(t){e.$set(e.form,"weChatMchid",t)},expression:"form.weChatMchid"}})],1),a("el-form-item",{attrs:{prop:"weChatApiKey",label:"商户平台秘钥"}},[a("el-input",{attrs:{placeholder:""},model:{value:e.form.weChatApiKey,callback:function(t){e.$set(e.form,"weChatApiKey",t)},expression:"form.weChatApiKey"}})],1),a("el-form-item",{staticClass:"api-cert",attrs:{prop:"weChatApiCert",label:"weChatApiCert"}},[a("el-input",{attrs:{clearable:"",placeholder:"请上传“.p12”后缀的证书"},model:{value:e.form.weChatApiCert,callback:function(t){e.$set(e.form,"weChatApiCert",t)},expression:"form.weChatApiCert"}}),a("el-upload",{ref:"_upload",attrs:{action:"/api/v1/app/upload",name:"fileByte",accept:".p12,.pfx","on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,limit:1}},[a("el-button",{staticClass:"upload-button",attrs:{type:"primary",plain:""}},[e._v(e._s(e.form.weChatApiCert?"重新上传":"上传证书"))])],1)],1),a("el-form-item",{attrs:{prop:"goldCoinRatio",label:"金币兑换比例"}},[a("el-input",{attrs:{disabled:"edit"===e.mode,placeholder:"请输入数值"},model:{value:e.form.goldCoinRatio,callback:function(t){e.$set(e.form,"goldCoinRatio",t)},expression:"form.goldCoinRatio"}},[a("template",{slot:"append"},[e._v(" 金币=1元 ")])],2)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleCancel}},[e._v("取 消")]),a("el-button",{attrs:{size:"small",type:"primary",loading:e.submitting},on:{click:e.handleOk}},[e._v("确 定")])],1)],1)},s=[],d=(a("4160"),a("a9e3"),a("b64b"),a("159b"),{id:null,name:"",pkg:"",weChatAppId:"",weChatAppSecret:"",weChatMchid:"",weChatApiKey:"",weChatApiCert:"",goldCoinRatio:"",hasWechatWithdrawal:!1,isDebugModel:!1,appVns:"",sids:""}),c={name:"appEditPopup",components:{},data:function(){return{dialogVisible:!1,submitting:!1,versionEditable:!1,form:{id:null,name:"",pkg:"",weChatAppId:"",weChatAppSecret:"",weChatMchid:"",weChatApiKey:"",weChatApiCert:"",goldCoinRatio:"",hasWechatWithdrawal:!1,isDebugModel:!1,appVns:"",sids:""},formRules:{name:[{required:!0,message:"请填写应用名"}],pkg:[{required:!0,message:"请填写包名"}],weChatAppId:[{required:!0,message:"请填写微信AppId"}],weChatAppSecret:[{required:!0,message:"请填写开发平台APP Secret"}],appVns:[{validator:this.validAppVns}]}}},props:{visible:{type:Boolean}},computed:{mode:function(){return this.form.id?"edit":"create"}},methods:{resetPanel:function(){var e=this;Object.keys(this.form).forEach((function(t){e.form[t]=d[t]})),this.versionEditable=!1,this.$nextTick((function(){e.$refs.form.clearValidate()}))},handleCancel:function(){this.dialogVisible=!1},handleOk:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.submitting=!0;var a=e.form.id?"updateApp":"addApp";l["a"][a](e.form).then((function(t){e.$emit("ok",!e.form.id),e.dialogVisible=!1})).finally((function(){e.submitting=!1}))}}))},fillData:function(e){var t=this;Object.keys(this.form).forEach((function(a){a in e&&void 0!==e[a]&&(t.form[a]=e[a])}))},validCoin:function(e,t,a){/^\d+$/.test(t)&&Number(t)>0?a():a(new Error("请填写正整数"))},validAppVns:function(e,t,a){/^\d+(,\d+)*$/.test(t)||""===t||null===t?a():a(new Error("版本号为纯数字，多个版本号用英文逗号分隔"))},handleUploadSuccess:function(e,t,a){"0000"===e.code?(this.$message({type:"success",message:"上传成功"}),this.form.weChatApiCert=e.result.weChatApiCert):this.$message({type:"error",message:"上传失败: ".concat(e.code)}),this.$refs._upload.clearFiles()},handleUploadError:function(e,t,a){console.log(e)}},watch:{visible:{handler:function(e){this.dialogVisible=e},immediate:!0},dialogVisible:function(e){this.$emit("update:visible",e)}},created:function(){},mounted:function(){},destroyed:function(){}},p=c,u=(a("a950"),a("2877")),f=Object(u["a"])(p,n,s,!1,null,"640a82ca",null),h=f.exports,m={name:"",components:{editPopup:h},mixins:[r["a"]],data:function(){return{showPopup:!1,query:{pkg:""}}},props:{},computed:{},methods:{search:function(e){var t=this;this.tableLoading||(e&&(this.query.pageNum=1),this.tableLoading=!0,l["a"].getList(this.query).then((function(e){t.total=e.total,t.tableData=e.lists})).finally((function(){t.tableLoading=!1})))},handleAdd:function(){this.showPopup=!0,this.$refs.editPopup.resetPanel()},handleEdit:function(e){this.showPopup=!0,this.$refs.editPopup.fillData(e)},handleDel:function(e){var t=this;this.$set(e,"_deleting",!0),l["a"].delApp(e.id).then((function(e){var a=t.query.pageNum;1===t.tableData.length&&(t.query.pageNum=a-1||1),t.search()})).finally((function(){t.$set(e,"_deleting",!1)}))}},watch:{},created:function(){this.search(!0)},mounted:function(){},destroyed:function(){}},b=m,g=Object(u["a"])(b,o,i,!1,null,"14f5aa59",null);t["default"]=g.exports},"619b":function(e,t,a){"use strict";a("ac1f"),a("841c");var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"do-pagination"},[a("el-pagination",e._g(e._b({attrs:{layout:e.layout,background:e.background}},"el-pagination",e.$attrs,!1),e.$listeners))],1)},i=[],r={name:"BasePagination",components:{},inheritAttrs:!1,data:function(){return{}},props:{background:{default:!0},layout:{default:"total, prev, pager, next,jumper, sizes"}},computed:{},methods:{handlePnChange:function(e){this.$emit("current-change",e)},handleSizeChange:function(e){this.$emit("size-change",e)}},watch:{},created:function(){},mounted:function(){},destroyed:function(){}},l=r,n=a("2877"),s=Object(n["a"])(l,o,i,!1,null,null,null),d=s.exports;t["a"]={components:{BasePagination:d},data:function(){var e,t,a={prop:"id",order:"descending"},o=["descending","ascending",null];return{defaultSort:a,defaultSortOrders:o,tableLoading:!1,query:{pageNum:1,pageSize:(null===this||void 0===this||null===(e=this.$store)||void 0===e||null===(t=e.state)||void 0===t?void 0:t.pageSize)||20,orderBy:a.prop,sequence:a.order},total:0,tableData:[]}},methods:{handlePnChange:function(e){this.query.pageNum=e,this.search()},handleSizeChange:function(e){this.query.pageSize=e,this.$store.commit("setPageSize",e),this.search&&this.search(!0)},handleSortChange:function(e){var t=e.prop,a=e.order;this.query.orderBy=t,this.query.sequence=a,this.search(!0)}}}},"841c":function(e,t,a){"use strict";var o=a("d784"),i=a("825a"),r=a("1d80"),l=a("129f"),n=a("14c3");o("search",1,(function(e,t,a){return[function(t){var a=r(this),o=void 0==t?void 0:t[e];return void 0!==o?o.call(t,a):new RegExp(t)[e](String(a))},function(e){var o=a(t,e,this);if(o.done)return o.value;var r=i(e),s=String(this),d=r.lastIndex;l(d,0)||(r.lastIndex=0);var c=n(r,s);return l(r.lastIndex,d)||(r.lastIndex=d),null===c?-1:c.index}]}))},a950:function(e,t,a){"use strict";var o=a("3685"),i=a.n(o);i.a}}]);
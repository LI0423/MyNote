(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["config"],{"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},"619b":function(t,e,a){"use strict";a("ac1f"),a("841c");var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"do-pagination"},[a("el-pagination",t._g(t._b({attrs:{layout:t.layout,background:t.background}},"el-pagination",t.$attrs,!1),t.$listeners))],1)},n=[],o={name:"BasePagination",components:{},inheritAttrs:!1,data:function(){return{}},props:{background:{default:!0},layout:{default:"total, prev, pager, next,jumper, sizes"}},computed:{},methods:{handlePnChange:function(t){this.$emit("current-change",t)},handleSizeChange:function(t){this.$emit("size-change",t)}},watch:{},created:function(){},mounted:function(){},destroyed:function(){}},s=o,l=a("2877"),r=Object(l["a"])(s,i,n,!1,null,null,null),d=r.exports;e["a"]={components:{BasePagination:d},data:function(){var t,e,a={prop:"id",order:"descending"},i=["descending","ascending",null];return{defaultSort:a,defaultSortOrders:i,tableLoading:!1,query:{pageNum:1,pageSize:(null===this||void 0===this||null===(t=this.$store)||void 0===t||null===(e=t.state)||void 0===e?void 0:e.pageSize)||20,orderBy:a.prop,sequence:a.order},total:0,tableData:[]}},methods:{handlePnChange:function(t){this.query.pageNum=t,this.search()},handleSizeChange:function(t){this.query.pageSize=t,this.$store.commit("setPageSize",t),this.search&&this.search(!0)},handleSortChange:function(t){var e=t.prop,a=t.order;this.query.orderBy=e,this.query.sequence=a,this.search(!0)}}}},"6f2b":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"AdConfig-page"},[a("h1",{staticClass:"main-title"},[t._v("广告配置 "),a("div",{staticClass:"right"},[t.$HAS_PERMISSION("mango:adConfig:w")?a("el-button",{attrs:{size:"medium",icon:"el-icon-plus",type:"success",plain:""},on:{click:t.handleAdd}},[t._v("增加配置")]):t._e()],1)]),a("div",{staticClass:"search-wrap do-card"},[a("div",{staticClass:"bd"},[a("el-form",{attrs:{inline:"","label-width":"100px"}},[a("el-form-item",{attrs:{label:"应用"}},[a("allApps",{model:{value:t.query.appId,callback:function(e){t.$set(t.query,"appId",e)},expression:"query.appId"}},[a("template",{slot:"prepend"},[a("el-option",{attrs:{value:"",label:"不限"}})],1)],2)],1),a("el-form-item",{attrs:{label:"版本号"}},[a("el-select",{on:{change:function(e){return t.search(!0)}},model:{value:t.query.appVn,callback:function(e){t.$set(t.query,"appVn",e)},expression:"query.appVn"}},[a("el-option",{attrs:{value:"",label:"不限"}}),t._l(t.appVersions,(function(t){return a("el-option",{key:t,attrs:{value:t,label:t}})}))],2)],1),a("el-form-item",{attrs:{label:"Sid"}},[a("el-select",{on:{change:function(e){return t.search(!0)}},model:{value:t.query.sid,callback:function(e){t.$set(t.query,"sid",e)},expression:"query.sid"}},[a("el-option",{attrs:{value:"",label:"不限"}}),t._l(t.sids,(function(t){return a("el-option",{key:t,attrs:{value:t,label:t}})}))],2)],1)],1),a("div",{staticClass:"ctrl tr"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.search(!0)}}},[t._v("搜索")])],1)],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticClass:"table-wrap do-card"},[a("div",{staticClass:"bd"},[a("el-table",{staticClass:"hide-border",attrs:{data:t.tableData,border:"","default-sort":{prop:t.defaultSort.prop,order:t.defaultSort.order}},on:{"sort-change":t.handleSortChange}},[a("el-table-column",{attrs:{label:"id","show-overflow-tooltip":!0,sortable:"custom","sort-orders":t.defaultSortOrders,prop:"id"}}),a("el-table-column",{attrs:{label:"应用","min-width":"","show-overflow-tooltip":!0,sortable:"custom","sort-orders":t.defaultSortOrders,prop:"name"}}),a("el-table-column",{attrs:{label:"版本","min-width":"","show-overflow-tooltip":!0,prop:"appVns"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.appVns.replace("all","所有版本"))+" ")]}}])}),a("el-table-column",{attrs:{label:"SID","min-width":"","show-overflow-tooltip":!0,prop:"sids"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.sids.replace("all","所有广告位"))+" ")]}}])}),a("el-table-column",{attrs:{label:"地域限制","min-width":"","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(a.provinceName)+">"+t._s(a.cityName)+" ")]}}])}),a("el-table-column",{attrs:{label:"修改人",width:"90","show-overflow-tooltip":!0,sortable:"custom","sort-orders":t.defaultSortOrders,prop:"lastModifyBy"}}),a("el-table-column",{attrs:{label:"修改时间","min-width":"","show-overflow-tooltip":!0,sortable:"custom","sort-orders":t.defaultSortOrders,prop:"lastModifyTime"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v(" "+t._s(t._f("date")(a.lastModifyTime,"dateTime"))+" ")]}}])}),a("el-table-column",{attrs:{label:"状态",width:"95",align:"left","show-overflow-tooltip":!0,sortable:"custom","sort-orders":t.defaultSortOrders,prop:"status"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[t.$HAS_PERMISSION("mango:adConfig:w")?a("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(e){return t.handleStatusChange(i)}},model:{value:i.status,callback:function(e){t.$set(i,"status",e)},expression:"row.status"}}):t._e(),i.__statusChange?a("span",{staticClass:"pl-gap-xs"},[a("i",{staticClass:"el-icon-loading"})]):a("span",{class:[{"color-primary":1===i.status},"pl-gap-xs"]},[t._v(t._s(1===i.status?"上线":"下线"))])]}}])}),t.$HAS_PERMISSION("mango:adConfig:w")?a("el-table-column",{attrs:{"class-name":"ctrl-td",width:"70px",align:"center",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{attrs:{type:"primary",plain:"",size:"mini",icon:"el-icon-edit"},on:{click:function(e){return t.handleEdit(i)}}})]}}],null,!1,2674049961)}):t._e()],1)],1)]),a("base-pagination",{attrs:{"current-page":t.query.pageNum,"page-size":t.query.pageSize,total:t.total},on:{"current-change":t.handlePnChange,"size-change":t.handleSizeChange}}),a("edit-popup",{ref:"editPopup",attrs:{visible:t.showPopup},on:{ok:t.handleEditPopOk,"update:visible":function(e){t.showPopup=e}}})],1)},n=[],o=(a("4de4"),a("d3b7"),a("ac1f"),a("841c"),a("1276"),a("619b")),s=(a("99af"),{getList:function(t){return window.axios.get("/appAdConfig",{params:t})},getConfigDetail:function(t){return window.axios.get("/appAdConfig/".concat(t))},changeStatus:function(t){var e=t.id,a=t.status;return window.axios.put("/appAdConfig/".concat(e,"/").concat(a))},addConfig:function(t){return window.axios.post("/appAdConfig",t)},updateConfig:function(t){return window.axios.put("/appAdConfig/".concat(t.id),t)}}),l=a("1a91"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:("create"===t.mode?"添加":"修改")+"配置",visible:t.dialogVisible,width:"450px"},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.resetPanel}},[a("el-form",{ref:"form",attrs:{"label-width":"120px",size:"small",model:t.form,rules:t.formRules}},[a("el-form-item",{attrs:{prop:"appId",label:"应用名"}},[a("allApps",{attrs:{disabled:"edit"===t.mode},on:{change:t.handleAppChange},model:{value:t.form.appId,callback:function(e){t.$set(t.form,"appId",e)},expression:"form.appId"}})],1),t.form.appId?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.appInfoLoading,expression:"appInfoLoading"}],staticClass:"app-info"},[a("el-form-item",{attrs:{prop:"pkg",label:"包名"}},[a("el-input",{attrs:{disabled:"",placeholder:"请填写包名"},model:{value:t.form.pkg,callback:function(e){t.$set(t.form,"pkg",e)},expression:"form.pkg"}})],1),a("el-form-item",{attrs:{prop:"appVns",label:"版本号"}},[a("el-select",{ref:"appVns",attrs:{multiple:"",placeholder:""},on:{change:function(e){return t.filterSpecialOption("appVns")}},model:{value:t.form.appVns,callback:function(e){t.$set(t.form,"appVns",e)},expression:"form.appVns"}},[a("el-option",{attrs:{label:"全部版本",value:"all"}}),t._l(t.appVersions,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}))],2)],1),a("el-form-item",{attrs:{prop:"sids",label:"广告位"}},[a("el-select",{ref:"sids",attrs:{multiple:"",placeholder:""},on:{change:function(e){return t.filterSpecialOption("sids")}},model:{value:t.form.sids,callback:function(e){t.$set(t.form,"sids",e)},expression:"form.sids"}},[a("el-option",{attrs:{label:"全部位置",value:"all"}}),t._l(t.sids,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}))],2)],1)],1):t._e(),a("el-form-item",{attrs:{label:"地域限制"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"provinceCode"}},[a("el-select",{staticClass:"province-select",attrs:{placeholder:""},on:{change:t.handleProvinceChange},model:{value:t.form.provinceCode,callback:function(e){t.$set(t.form,"provinceCode",e)},expression:"form.provinceCode"}},[a("el-option",{attrs:{label:"全部",value:"all"}}),t._l(t.cityData,(function(t){return a("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})}))],2),t._v("省 ")],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{prop:"cityCode"}},[a("el-select",{staticClass:"city-select",attrs:{placeholder:""},model:{value:t.form.cityCode,callback:function(e){t.$set(t.form,"cityCode",e)},expression:"form.cityCode"}},[a("el-option",{attrs:{label:"全部",value:"all"}}),t._l(t.cityOptions,(function(t){return a("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})}))],2),t._v("市 ")],1)],1)],1),a("section",{staticClass:"details"},[a("el-form-item",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}],attrs:{prop:"details.status",label:"配置状态"}},[a("el-switch",{attrs:{"active-text":"开启","inactive-text":"关闭","active-value":"1","inactive-value":"0"},on:{change:t.handleDetailStatus},model:{value:t.form.details.status,callback:function(e){t.$set(t.form.details,"status",e)},expression:"form.details.status"}})],1),"1"===t.form.details.status?a("div",{staticClass:"details-configs"},[a("div",{staticClass:"details-group"},[a("div",{staticClass:"details-group__title"},[t._v("广告刷新配置")]),a("el-form-item",{attrs:{prop:"details.ari",label:"刷新时间"}},[a("el-input",{attrs:{placeholder:""},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("秒")]},proxy:!0}],null,!1,1582984321),model:{value:t.form.details.ari,callback:function(e){t.$set(t.form.details,"ari",e)},expression:"form.details.ari"}})],1),a("el-form-item",{attrs:{prop:"details.arnupr",label:"新用户保护时间"}},[a("el-input",{attrs:{placeholder:""},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("分钟")]},proxy:!0}],null,!1,2456940938),model:{value:t.form.details.arnupr,callback:function(e){t.$set(t.form.details,"arnupr",e)},expression:"form.details.arnupr"}})],1)],1),a("div",{staticClass:"details-group"},[a("div",{staticClass:"details-group__title"},[t._v("广告误点击配置")]),a("el-form-item",{attrs:{prop:"details.acnupr",label:"新用户保护时间"}},[a("el-input",{attrs:{placeholder:""},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("分钟")]},proxy:!0}],null,!1,2456940938),model:{value:t.form.details.acnupr,callback:function(e){t.$set(t.form.details,"acnupr",e)},expression:"form.details.acnupr"}})],1),a("el-form-item",{attrs:{prop:"details.acmr",label:"误点击比例"}},[a("el-input",{attrs:{placeholder:"请填写0～1之间的小数"},model:{value:t.form.details.acmr,callback:function(e){t.$set(t.form.details,"acmr",e)},expression:"form.details.acmr"}})],1)],1)]):t._e()],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:t.handleCancel}},[t._v("取 消")]),a("el-button",{attrs:{size:"small",type:"primary",loading:t.submitting},on:{click:t.handleOk}},[t._v("确 定")])],1)],1)},d=[],u=(a("4160"),a("caad"),a("45fc"),a("a9e3"),a("b64b"),a("2532"),a("159b"),a("5530")),c=a("2f62"),p=a("ed08"),f={id:null,appId:"",pkg:"",appVns:[],sids:[],provinceCode:"all",cityCode:"all",details:{status:"0",ari:"10",arnupr:"120",acnupr:"120",acmr:"0.2"}},h={name:"adConfigEditPopup",components:{},data:function(){return{dialogVisible:!1,submitting:!1,detailLoading:!1,appInfoLoading:!1,appVersions:[],sids:[],cityOptions:[],form:{id:null,appId:"",pkg:"",appVns:[],sids:[],provinceCode:"all",cityCode:"all",details:{status:"0",ari:"",arnupr:"",acnupr:"",acmr:""}},formRules:{appId:[{required:!0,message:"请选择应用"}],pkg:[{required:!0,message:"包名不能为空"}],appVns:[{required:!0,message:"请选择版本"},{validator:this.validSpecialOption}],sids:[{required:!0,message:"请选择广告位"},{validator:this.validSpecialOption}],provinceCode:[{required:!0,message:"请选择省份"}],cityCode:[{required:!0,message:"请选择城市"}],"details.ari":[{validator:this.validDetailsRequire},{validator:this.validIntegerIfNotEmpty}],"details.arnupr":[{validator:this.validDetailsRequire},{validator:this.validIntegerIfNotEmpty}],"details.acnupr":[{validator:this.validDetailsRequire},{validator:this.validIntegerIfNotEmpty}],"details.acmr":[{validator:this.validAcmr}]}}},props:{visible:{type:Boolean}},computed:Object(u["a"])(Object(u["a"])({},Object(c["b"])(["cityData"])),{},{mode:function(){return this.form.id?"edit":"create"}}),methods:{resetPanel:function(){var t=this;Object.keys(this.form).forEach((function(e){switch(e){case"details":t.form[e]={status:"0",ari:"",arnupr:"",acnupr:"",acmr:""};break;default:t.form[e]=f[e]}})),this.appVersions=[],this.sid=[],this.$nextTick((function(){t.$refs.form.clearValidate()}))},handleCancel:function(){this.dialogVisible=!1},handleOk:function(){var t=this;this.$refs.form.validate((function(e){if(e){t.submitting=!0;var a=t.form.id?"updateConfig":"addConfig",i=t.formatFormToSubmit();s[a](i).then((function(e){t.$emit("ok",Boolean(!t.form.id),t.form.appId),t.dialogVisible=!1})).finally((function(){t.submitting=!1}))}}))},formatFormToSubmit:function(){var t=p["a"].deepClone(this.form),e=[];for(var a in t.details){var i=a,n=t.details[a];e.push({key:i,value:n})}return t.details=e,t},fillData:function(t){var e=this;Object.keys(this.form).forEach((function(a){if(a in t&&void 0!==t[a])switch(a){case"appVns":case"sids":e.form[a]=t[a].split(",");break;case"details":break;default:e.form[a]=t[a]}}))},getConfigDetail:function(t){var e=this;this.detailLoading=!0,s.getConfigDetail(t).then((function(t){e.formatDetails(t.details||[])})).finally((function(){e.detailLoading=!1}))},formatDetails:function(t){var e=this;t.forEach((function(t){var a=t.key;a in e.form.details&&(e.form.details[a]=t.value)}))},fillAppInfo:function(){var t=this,e=this.form.appId;e&&(this.appInfoLoading=!0,l["a"].getAppInfo(e).then((function(e){var a=(e.appVns||"").split(",").filter((function(t){return""!==t})),i=(e.sids||"").split(",").filter((function(t){return""!==t}));t.appVersions=a,t.sids=i,t.form.pkg=e.pkg})).finally((function(){t.appInfoLoading=!1})))},handleAppChange:function(t){if(!t)return this.appVersions=[],void(this.sids=[]);this.form.appVns=["all"],this.form.sids=["all"],this.fillAppInfo()},show:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id||null;this.dialogVisible=!0,e&&(this.fillData(t),this.fillAppInfo(),this.getConfigDetail(e))},filterSpecialOption:function(t){var e=this.form[t],a=e[e.length-1];"all"===a?(this.form[t]=["all"],this.$refs[t]&&this.$refs[t].blur()):this.form[t]=e.filter((function(t){return"all"!==t}))},validSpecialOption:function(t,e,a){var i=t.field,n={appVns:"版本",sids:"广告位"};e.includes("all")&&1!==e.length?a(new Error("全部".concat(n[i],"和其它选项互斥！"))):a()},validInteger:function(t,e,a){var i=/^\d+$/;i.test(e)?a():a(new Error("请填写整数"))},validFloat:function(t,e,a){var i=/^\d+(.\d+)?$/;i.test(e)?a():a(new Error("小数格式错误"))},validIntegerIfNotEmpty:function(t,e,a){e&&this.validInteger.apply(this,arguments),a()},validDetailsRequire:function(t,e,a){var i=this,n=t.field.split(".")[1],o={ari:["arnupr"],arnupr:["ari"],acnupr:["acmr"],acmr:["acnupr"]},s=o[n]||[],l=s.some((function(t){return""!==i.form.details[t]}));l&&""===e&&a(new Error("必填")),a()},validAcmr:function(t,e,a){var i=Number(e);""===this.form.details.acnupr&&""===e||i>0&&i<1&&![""].includes(e)&&/^\d+(.\d+)?$/.test(e)?a():a(new Error("请填写0～1之间的小数"))},fillCityOptions:function(t){if(t){var e=this.cityData.filter((function(e){return e.code===t}))[0]||{};this.cityOptions=e.children||[]}else this.cityOptions=[]},handleProvinceChange:function(t){this.form.cityCode="all",this.fillCityOptions(t)},handleDetailStatus:function(t){var e=this,a=Object.keys(f.details).filter((function(t){return"status"!==t}));"0"!==t&&a.forEach((function(t){""===e.form.details[t]&&(e.form.details[t]=f.details[t])}))}},watch:{visible:{handler:function(t){this.dialogVisible=t},immediate:!0},dialogVisible:function(t){this.$emit("update:visible",t)},"form.provinceCode":function(t){this.fillCityOptions(t)}},created:function(){this.$store.dispatch("getCityData")},mounted:function(){},destroyed:function(){}},m=h,v=(a("8b9e"),a("2877")),g=Object(v["a"])(m,r,d,!1,null,"1066eff2",null),b=g.exports,y={name:"AdConfig",components:{editPopup:b},mixins:[o["a"]],data:function(){return{showPopup:!1,appVersions:[],sids:[],query:{appId:"",appVn:"",sid:""}}},props:{},computed:{},methods:{search:function(t){var e=this;this.tableLoading||(t&&(this.query.pageNum=1),this.tableLoading=!0,s.getList(this.query).then((function(t){e.total=t.total,e.tableData=t.lists})).finally((function(){e.tableLoading=!1})))},handleAdd:function(){this.$refs.editPopup.show()},handleEdit:function(t){this.$refs.editPopup.show(t)},handleDel:function(t){var e=this;this.$set(t,"_deleting",!0),s.del(t.id).then((function(t){var a=e.query.pageNum;1===e.tableData.length&&(e.query.pageNum=a-1||1),e.search()})).finally((function(){e.$set(t,"_deleting",!1)}))},handleAppChange:function(t){var e=this;if(!t)return this.appVersions=[],void(this.sids=[]);this.query.appVn="",this.query.sid="",l["a"].getAppInfo(t).then((function(t){var a=t.appVns||"",i=t.sids||"";e.appVersions=a.split(",").filter((function(t){return""!==t})),e.sids=i.split(",").filter((function(t){return""!==t}))}))},handleStatusChange:function(t){var e=this,a=t.status,i=1===a?0:1;this.$set(t,"__statusChange",!0),s.changeStatus({id:t.id,status:a}).then((function(t){})).catch((function(e){t.status=i})).finally((function(a){e.$set(t,"__statusChange",!1)}))},handleEditPopOk:function(t,e){e!==this.query.appId&&""!==this.query.appId&&(this.query.appId="",this.query.appVn="",this.query.sid=""),this.search(t)}},watch:{"query.appId":{handler:function(t){this.handleAppChange(t)},immediate:!0}},created:function(){this.search(!0)},mounted:function(){},destroyed:function(){}},C=y,w=Object(v["a"])(C,i,n,!1,null,"321bb71f",null);e["default"]=w.exports},"841c":function(t,e,a){"use strict";var i=a("d784"),n=a("825a"),o=a("1d80"),s=a("129f"),l=a("14c3");i("search",1,(function(t,e,a){return[function(e){var a=o(this),i=void 0==e?void 0:e[t];return void 0!==i?i.call(e,a):new RegExp(e)[t](String(a))},function(t){var i=a(e,t,this);if(i.done)return i.value;var o=n(t),r=String(this),d=o.lastIndex;s(d,0)||(o.lastIndex=0);var u=l(o,r);return s(o.lastIndex,d)||(o.lastIndex=d),null===u?-1:u.index}]}))},"8b9e":function(t,e,a){"use strict";var i=a("9ba1"),n=a.n(i);n.a},"9ba1":function(t,e,a){}}]);
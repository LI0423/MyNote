# RAG（Retrievval-Augment-Generation，检索增强生成）

RAG流程：分片 -> 索引（提问前） -> 召回 -> 重排 -> 生成（提问后）

## 分片

将一个当文档切分成多个片段。分片有以下方式：

- 按照字数划分；
- 按照段落划分；
- 按照章节划分；
- 按照页码划分。

## 索引

1. 通过Embedding将片段文本转换为向量。
2. 将片段文本和片段向量存储到向量数据库中。

### Embedding

将文本转换为向量的一个过程。含义相近的文本在经过Embedding之后，对应的向量也是相近的。

Embedding操作通常是由专门的Embedding模型来完成的。mteb排行榜可以看哪个模型好用。

### 向量数据库

用于存储和查询向量的数据库。不仅需要存储向量，也需要存储原始文本。目的是通过向量可以获取到对应的原始文本。

## 召回

搜索与用户问题相关片段的过程。

用户问题 -> Embedding模型 -> 问题向量 -> 向量数据库 -> 用户问题相关片段。

### 向量相似度计算方法

- 余弦相似度：计算两个向量之间夹角的cos值，根据cos值判断夹角大小，夹角越小，相似度越高。
- 欧氏距离：计算两个向量之间的距离，距离越小，相似度越高。
- 点积：通过代数方式衡量两个向量相似度，不仅考虑向量的方向关系，也要考虑向量的长度。

### 相似度计算方法特点

- 成本低。
- 耗时短。
- 准确率低。

适合初步筛选。

## 重排

从召回结果中挑选与用户问题最相似的结果作为重排的结果。使用cross-encoder模型计算每个片段和用户问题的相似度。

## 生成

将用户问题和重排后获取的相似片段一同发送给大语言模型，让大模型根据片段内容来回答用户问题。
